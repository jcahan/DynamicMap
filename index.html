<!-- Followed this tutorial to create the map: http://www.youtube.com/watch?v=n8aKDIKRr7g -->

<!DOCTYPE HTML>
<html>
	<head>
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="http://d3js.org/topojson.v1.min.js"></script>
 		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
 		<script src="http://jqueryjs.googlecode.com/files/jquery-1.2.6.min.js"></script>
 		<script src="latLongTrimmer.js"></script>
 		

 		<style type="text/css">
 			html, body, #map{

 				width: 100%;
 				height: 100%;
 				margin: 0;
 				padding: 0;
 			}
 			.coordinates, .coordinates svg {
 				position: absolute;
 			}

 			.coordinates svg {
 				width: 60px; 
 				height: 20px; 
 				padding-right: 100px;
 				font: 10px sans-serif;
 			}

 			.coordinates circle {
 				fill: brown; 
 				stroke: black; 
 				stroke-width: 1.5px; 
 			}
 		</style>
 		


 		<!--	
 			key=AIzaSyBFWEltAPYhKyhrMucpSLcdKCNkgMcwKM0&
 		-->
	</head>
 	
 	<body>
 		<div id="map"></div>
 		<script type = "text/javascript">
			
			//Create the Google Map...
			const var LAT_INDEX = 0; 
			const var LONG_INDEX = 1; 
			var latlng = new google.maps.LatLng(40.700682761880564,-74.03005242347717); 
			var map = new google.maps.Map(d3.select("#map").node(), myOptions); 

			var myOptions = {
				zoom: 10, 
				center: latlng,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};
			
			//Loading JSON data from LatLongTrimmer 
			var myJsonText = startThis();
			d3.json(myJsonText, function(data) {
				var overlay = new google.maps.OverlayView(); 

				overlay.onAdd = function() {
					var layer = d3.select(this.getPanese.overlayLayer).append("div")
						.attr("class", "coordinates"); 

					//Draw each marker as separate SVG element 
					overlay.draw = function() {
						var projection = this.getProjection(), 
							padding = 10; 
						var marker = layer.selectAll("svg")
							.data(d3.entries(data))
							.each(transform)
						  .enter().append("svg:svg")
							.each(transform)
							.attr("class","marker"); 
   					
   						//creates a circle 
   						//TODO: Here, I need to make size of SVG a function of a variable!!
						marker.append("svg:circle")
							.attr("r", 4.5)
							.attr("cx", padding)
							.attr("cy", padding); 

						//Add a label
						/*
						marker.append("svg:text")
							.attr("x", padding + 7)
							.attr("y", padding)
							.attr("dy", ".31em")
							.text(function(d) { return d. //SOMEHOW SPECIFY LAT, LONG!!})
						*/
						function transform(d) {
							d = new google.maps.LatLng(d.value[LAT_INDEX], d.value[LONG_INDEX]); 
							d = projection.fromLatLngToDivPixel(d); 
							return d3.select(this)
								.style("left",(d.x-padding) + "px")
								.style("top", (d.y - padding) + "px"); 
						} //closes transform
					}; //closes draw
				};  //closes onAdd
				overlay.setMap(map); 
			});  //closes JSON
			
 		</script>
 	</body>
</html>